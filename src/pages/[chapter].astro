---
import { getCollection } from "astro:content";
import BaseHead from "../base/BaseHead.astro";
import MobileLayout from "../base/layouts/MobileLayout.astro";

import StackHeader from "../components/StackHeader.astro";
import SlokItem from "../components/SlokItem.astro";


export const prerender = true;
export async function getStaticPaths() {
  const chapters = await getCollection("chapters");

  return chapters.map((chapter) => ({
    params: { chapter: chapter.data.chapter_number.toString() },
    props: { chapter },
  }));
}

const { chapter } = Astro.props;
const allSloks = await getCollection("sloks");
const sloks = allSloks.filter(
  (s) => s.data.chapter_number === +Astro.params.chapter,
);

const sortedSloks = sloks.sort(
  (a, b) => a.data.verse_number - b.data.verse_number,
);


---

<BaseHead
  description={`${chapter.data.chapter_summary.substring(0, 40)} |  Read all sloks of Chapter ${chapter.data.chapter_number} with meaning and explanation`}
  title={`Bhagavad Gita Chapter ${chapter.data.chapter_number} - ${chapter.data.name_meaning}  | ${chapter.data.name}  | Full Sloks with Meaning`}
>
  <MobileLayout showBottomBar={false}>
    <StackHeader title={chapter.data.name_meaning} href="/" />
    <div class="main m-2 gap-2 flex flex-col">
      {sortedSloks.map((slok) => <SlokItem slok={slok} />)}
    </div>
  </MobileLayout>
</BaseHead>
